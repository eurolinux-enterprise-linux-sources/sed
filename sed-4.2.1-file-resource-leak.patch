From fbc0374ed1947a304f35d3eadb5285d15e79daba Mon Sep 17 00:00:00 2001
From: "Vojtech Vitek (V-Teq)" <vvitek@redhat.com>
Date: Fri, 4 May 2012 12:07:45 +0200
Subject: [PATCH] Fix minor FILE resource leaks

Originally reported at http://bugzilla.redhat.com/show_bug.cgi?id=812316
---
 sed/utils.c |   12 ++++++++++--
 1 files changed, 10 insertions(+), 2 deletions(-)

diff --git a/sed/utils.c b/sed/utils.c
index f7a56e2..2ba48a6 100644
--- a/sed/utils.c
+++ b/sed/utils.c
@@ -446,13 +446,21 @@ _copy (from, to)
       if (bytes_in == 0)
        {
          if (ferror (infile))
-           return -1;
+           {
+             fclose (outfile);
+             fclose (infile);
+             return -1;
+           }
          break;
        }
 
       bytes_out = fwrite (buf, 1, bytes_in, outfile);
       if (bytes_out != bytes_in)
-        return -1;
+        {
+          fclose(outfile);
+          fclose(infile);
+          return -1;
+        }
     }
 
   fclose (outfile);
-- 
1.7.6.5

